{% extends 'nflpix/base.html' %}

{% block content %}
<h2 class="text-2xl font-bold text-neon mb-6">Make Your Picks</h2>
<form method="POST" action="{% url 'schedule' %}">
  {% csrf_token %}
  {% if league %}
    <input type="hidden" name="league" value="{{ league.id }}">
  {% endif %}

  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    {% for item in games_with_info %}
      {% with game=item.game %}
      <div class="card p-4 flex flex-col justify-between">
        <div class="flex justify-between mb-4">
          <div class="flex items-center gap-2">
            <img src="{{ game.away_logo }}" class="team-logo" alt="{{ game.away_team }}">
            <span>{{ game.away_team }}</span>
          </div>
          <span class="text-muted">vs</span>
          <div class="flex items-center gap-2">
            <img src="{{ game.home_logo }}" class="team-logo" alt="{{ game.home_team }}">
            <span>{{ game.home_team }}</span>
          </div>
        </div>

        <p class="text-secondary text-sm mb-2">
          {{ game.start_time|timezone:"g:i A, M d" }}
          {% if item.started %}
            <span class="text-danger font-bold ml-2">Started</span>
          {% endif %}
        </p>

        {% if not item.started %}
          <div class="space-y-2 mb-2">
            <label class="inline-flex items-center">
              <input type="radio" name="pick_{{ game.id }}" value="away"
                     class="form-check-input" {% if item.user_pick == 'away' %}checked{% endif %}
                     {% if item.user_pick %}disabled{% endif %}>
              <span class="ml-2">{{ game.away_team }}</span>
            </label>
            <label class="inline-flex items-center">
              <input type="radio" name="pick_{{ game.id }}" value="home"
                     class="form-check-input" {% if item.user_pick == 'home' %}checked{% endif %}
                     {% if item.user_pick %}disabled{% endif %}>
              <span class="ml-2">{{ game.home_team }}</span>
            </label>
          </div>
          {% if item.user_pick %}
            <p class="text-neon bold">You picked:
              <strong>{{ game.home_team if item.user_pick == 'home' else game.away_team }}</strong>
            </p>
          {% endif %}
        {% else %}
          <p class="text-muted">You can't pick this game â€” it's already started.</p>
          {% if item.user_pick %}
            <p class="text-neon">Your pick was:
              <strong>{{ game.home_team if item.user_pick == 'home' else game.away_team }}</strong>
            </p>
          {% endif %}
        {% endif %}
      </div>
      {% endwith %}
    {% empty %}
      <div class="alert">No games scheduled for this week.</div>
    {% endfor %}
  </div>

  {% if games_with_info %}
    <div class="mt-6 text-center">
      <button type="submit" class="btn-primary px-6 py-2">Submit Picks</button>
    </div>
  {% endif %}
</form>
{% endblock %}
